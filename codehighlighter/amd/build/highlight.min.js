define(["jquery"],function(e){return{init:function(){console.log("highlight init"),jQuery.fn.parseCodeSplit=function(t,n){let i=e(this).html().split(/(<span.*?\/span>)/gi);for(let e=0;e<i.length;e+=2)i[e]=i[e].replace(t,'<span class="'+n+'">$1</span>');return i.join("")},jQuery.fn.parseCode=function(t,n){return e(this).html().replace(t,'<span class="'+n+'">$1</span>')},jQuery.fn.matchCode=function(t){let n=e(this).html().split(/(<span.*?\/span>)/gi);for(let e=0;e<n.length;e+=2)if(n[e].match(t))return!0;return!1},e(".chParser_JS").each(function(){console.log(this.className);let t,n=RegExp("chLang_([a-zA-Z]+)","gm");t=n.exec(this.className),console.log("Lang "+t[1]);let i=t[1];if(e.inArray(i,["cpp"])<0)return;let l=e(this).find("td:eq(1) pre");require(["filter_codehighlighter/"+i],function(t){if(null==t)return;let n=[];t.text.forEach(function(e,t){n.push("\\"+e+".*?\\"+e)});let i=new RegExp("("+n.join("|")+")","g"),s=[];for(let e in t.keywords)t.keywords.hasOwnProperty(e)&&s.push(new RegExp("\\b("+t.keywords[e].join("|")+")\\b",t.casesensitive[e]?"g":"gi"));let o=[];t.comment.forEach(function(e){o.push(e+".*")});for(let e=0;e<t.multicomment.length;e+=2)o.push(t.multicomment[e]+".*?"+t.multicomment[e+1]);l.each(function(t){e(this).html(e(this).parseCodeSplit(i,"text"))});for(let n=0;n<t.multicomment.length;n+=2){let i=0,s=t.multicomment[n],h=t.multicomment[n+1];l.each(function(t){i?(e(this).html(e(this).parseCode(new RegExp("(^.*?($|"+h+"))","g"),"multicomment")),e(this).html().match(new RegExp("("+h+")"),"g")&&(i=0)):e(this).html(e(this).parseCode(new RegExp("("+o.join("|")+")"),"comment"));let n=new RegExp("("+s+"((?!"+h+").)*$)","g");e(this).matchCode(n)&&(e(this).html(e(this).parseCode(n,"multicomment")),i=1)})}l.each(function(n){for(let t=0;t<s.length;++t)e(this).html(e(this).parseCodeSplit(s[t],"keyword"+(t+1)));e(this).html(e(this).parseCodeSplit(new RegExp("\\b("+t.number+")\\b","g"),"dec-number"))})})})}}});